<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#111827">
    <title>MarketMind</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-900 text-gray-100 font-sans antialiased flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="flex-none bg-gray-900/95 z-40 px-5 pt-safe-top pb-3 border-b border-gray-800">
        <div class="flex justify-between items-end h-12">
            <div>
                <h1 class="font-bold text-xl tracking-tight">Market<span class="text-blue-500">Mind</span></h1>
            </div>
            <div class="text-right flex flex-col items-end">
                <div id="connection-status" class="flex items-center gap-1 text-[10px] text-yellow-500">
                    <span class="animate-pulse">●</span> 连接中...
                </div>
                <div id="last-update-time" class="text-[10px] text-gray-500 font-mono">--:--</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow overflow-y-auto hide-scrollbar pb-24 relative" id="main-scroll-area">

        <!-- Dashboard Tab -->
        <section id="view-dashboard" class="p-5 space-y-6 block">
            <p class="text-xs text-gray-400 mb-2">主屏幕为您提炼当下最具交易价值的信号。</p>

            <!-- Hero Card -->
            <div id="hero-event-container" class="bg-gradient-to-br from-gray-800 to-gray-850 rounded-2xl p-5 border border-gray-700 shadow-xl relative overflow-hidden">
                <div class="hero-glow"></div>
                <div class="flex justify-between items-start mb-4 relative z-10">
                    <div class="flex-1 mr-2">
                        <span id="hero-event-type" class="text-blue-400 text-xs font-bold tracking-wider uppercase">核心数据</span>
                        <h2 id="hero-event-title" class="text-lg font-bold text-white mt-1 leading-snug">加载中...</h2>
                    </div>
                    <div id="hero-event-countdown" class="bg-gray-900 text-blue-300 px-2 py-1 rounded text-xs font-mono border border-gray-700 whitespace-nowrap mt-1">--:--:--</div>
                </div>
                <div class="grid grid-cols-3 gap-3 relative z-10">
                    <div class="bg-gray-900/60 p-2 rounded text-center">
                        <div class="text-gray-500 text-[10px] uppercase">前值</div>
                        <div id="hero-event-prev" class="text-white font-mono font-bold text-sm">--</div>
                    </div>
                    <div class="bg-gray-900/60 p-2 rounded text-center border border-blue-500/30">
                        <div class="text-blue-400 text-[10px] uppercase">预测</div>
                        <div id="hero-event-fore" class="text-blue-400 font-mono font-bold text-sm">--</div>
                    </div>
                    <div class="bg-gray-900/60 p-2 rounded text-center">
                        <div class="text-gray-500 text-[10px] uppercase">实际</div>
                        <div id="hero-event-act" class="text-gray-400 font-mono font-bold text-sm">--</div>
                    </div>
                </div>
                <div id="hero-event-ai" class="mt-3 text-xs text-gray-300 border-t border-gray-700/50 pt-2">
                    <span class="text-blue-400 font-bold">AI解读:</span> 加载中...
                </div>
                <div class="mt-3 border-t border-gray-700/50 pt-3 relative z-10">
                    <label class="text-[10px] text-gray-500 uppercase font-bold">查看其他核心数据 AI 解读</label>
                    <select id="macro-selector" class="w-full bg-gray-900 border border-gray-600 rounded p-1.5 text-xs text-white mt-1 outline-none appearance-none">
                        <option value="">加载中...</option>
                    </select>
                </div>
            </div>

            <!-- Upcoming Earnings Slider -->
            <div id="dashboard-custom-events-container" class="hidden">
                <h3 class="text-sm font-bold text-gray-300 uppercase tracking-wider mb-3">即将到来的自选财报 (7日内)</h3>
                <div id="dashboard-custom-events-list" class="flex overflow-x-auto gap-3 hide-scrollbar pb-2"></div>
            </div>

            <!-- Sentiment Chart -->
            <div>
                <div class="flex justify-between items-end mb-3">
                    <h3 class="text-sm font-bold text-gray-300 uppercase tracking-wider">市场多空力量 (AI判定)</h3>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 border border-gray-700 shadow-lg">
                    <div class="chart-container"><canvas id="sentimentChart"></canvas></div>
                    <p class="text-[10px] text-gray-500 text-center mt-2">基于过去24小时内突发新闻的 AI 评分聚合</p>
                </div>
            </div>

            <!-- News Preview -->
            <div>
                <div class="flex justify-between items-end mb-3">
                    <h3 class="text-sm font-bold text-gray-300 uppercase tracking-wider">Top 10 热点情报</h3>
                    <button onclick="switchTab('news')" class="text-xs text-blue-400 font-medium">查看全部</button>
                </div>
                <div id="dashboard-news-list" class="space-y-3">
                    <div class="text-center text-gray-500 text-sm py-4">正在从数据库拉取...</div>
                </div>
            </div>
        </section>

        <!-- Calendar Tab -->
        <section id="view-calendar" class="p-5 space-y-4 hidden relative">
            <div class="flex justify-between items-center mb-4">
                <p class="text-xs text-gray-400">宏观数据与您的自选财报日历</p>
                <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold py-1.5 px-3 rounded shadow">➕ 订阅财报</button>
            </div>
            <div id="calendar-list" class="space-y-3"></div>
        </section>

        <!-- Intelligence Tab -->
        <section id="view-news" class="p-5 space-y-4 hidden flex flex-col h-full">
            <p class="text-xs text-gray-400 mb-2">过去 24 小时内全网突发情报，已通过 AI 严格评分排序。</p>
            <div class="flex gap-2 mb-2">
                <button onclick="filterNews('all')" id="filter-all" class="filter-btn active px-3 py-1 rounded-full text-xs font-medium">全部</button>
                <button onclick="filterNews('bull')" id="filter-bull" class="filter-btn px-3 py-1 rounded-full text-xs font-medium">看多</button>
                <button onclick="filterNews('bear')" id="filter-bear" class="filter-btn px-3 py-1 rounded-full text-xs font-medium">看空</button>
            </div>
            <div id="intelligence-list" class="space-y-4 pb-10"></div>
        </section>

        <!-- Error State -->
        <section id="view-error" class="p-5 h-full flex flex-col items-center justify-center hidden">
            <div class="text-4xl mb-4">⚠️</div>
            <h2 class="text-xl font-bold text-yellow-500 mb-2">数据库尚未初始化</h2>
            <p class="text-gray-300 text-sm mb-6 text-center">配置已生效，但你需要检查 Firebase 控制台的连接状态。</p>
        </section>
    </main>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 w-full glass-nav z-40 pb-safe">
        <div class="flex justify-around items-center h-16 px-2">
            <button onclick="switchTab('dashboard')" id="tab-dashboard" class="nav-tab active flex flex-col items-center justify-center w-full h-full transition-colors">
                <span class="text-xl mb-1">📈</span>
                <span class="tab-label text-[10px] font-bold">概览</span>
            </button>
            <button onclick="switchTab('calendar')" id="tab-calendar" class="nav-tab flex flex-col items-center justify-center w-full h-full transition-colors">
                <span class="text-xl mb-1">📅</span>
                <span class="tab-label text-[10px] font-medium">日历</span>
            </button>
            <button onclick="switchTab('news')" id="tab-news" class="nav-tab flex flex-col items-center justify-center w-full h-full transition-colors">
                <span class="text-xl mb-1">🧠</span>
                <span class="tab-label text-[10px] font-medium">情报</span>
            </button>
        </div>
    </nav>

    <!-- Subscription Modal -->
    <div id="event-modal" class="hidden fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-2xl border border-gray-700 w-full max-w-sm p-6 shadow-2xl">
            <h3 class="text-lg font-bold text-white mb-4">订阅财报提醒</h3>
            <div class="space-y-4 relative">
                <div>
                    <label class="block text-xs text-gray-400 mb-2">搜索美股代码 (Ticker)</label>
                    <input
                        type="text"
                        id="ev-ticker"
                        oninput="handleTickerSearch(this.value)"
                        placeholder="输入如 NVDA, AAPL..."
                        autocomplete="off"
                        class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white text-base font-bold tracking-wider focus:border-blue-500 outline-none uppercase placeholder-gray-600"
                    >
                    <div id="ticker-suggestions" class="hidden absolute w-full bg-gray-700 border border-gray-600 rounded mt-1 z-50 max-h-40 overflow-y-auto shadow-xl"></div>
                </div>
                <div class="bg-blue-900/20 border border-blue-800/50 rounded p-3 text-xs text-blue-400">
                    💡 请在下拉列表中点击确认代码。提交后，后端引擎将自动获取精准发布时间。
                </div>
            </div>
            <div class="mt-6 flex gap-3 justify-end">
                <button onclick="closeModal()" class="px-4 py-2 rounded text-sm text-gray-400 hover:text-white transition-colors">取消</button>
                <button onclick="saveCustomEvent()" id="btn-save-event" class="px-5 py-2 rounded text-sm bg-blue-600 hover:bg-blue-500 text-white font-bold transition-all shadow-lg opacity-50 cursor-not-allowed" disabled>提交监控</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
