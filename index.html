<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<!-- 开启 iOS PWA 模式 -->
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta
			name="apple-mobile-web-app-status-bar-style"
			content="black-translucent"
		/>
		<title>MarketMind</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- React & ReactDOM -->
		<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
		<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
		<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

		<!-- Firebase 兼容版 SDK -->
		<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
		<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
	</head>
	<body class="bg-gray-900 text-white select-none">
		<div id="root"></div>

		<script type="text/babel">
			const { useState, useEffect } = React;

			// ===============================================
			// ⚠️ 请在这里粘贴你从 Firebase 复制的 firebaseConfig
			// ===============================================
			const firebaseConfig = {
			    apiKey: "AIzaSyAHnFy-RQTrJRIu4BFF4LnGA_PP6GWSDsk",
			    authDomain: "finance-app-447cc.firebaseapp.com",
			    projectId: "finance-app-447cc",
			    storageBucket: "finance-app-447cc.firebasestorage.app",
			    messagingSenderId: "453168549752",
			    appId: "1:453168549752:web:f8df55083f2aeb30c4028d",
			    measurementId: "G-ZM5V2VNLZR"
			};

			// 初始化 Firebase
			if (firebaseConfig.apiKey) {
			    firebase.initializeApp(firebaseConfig);
			}

			function App() {
			    const [macroData, setMacroData] = useState([]);
			    const [newsData, setNewsData] = useState([]);
			    const [lastUpdated, setLastUpdated] = useState("");
			    const [isConfigured] = useState(!!firebaseConfig.apiKey);

			    useEffect(() => {
			        if (!isConfigured) return;

			        const db = firebase.firestore();

			        // 实时监听宏观数据
			        const unsubMacro = db.collection('market_data').doc('macro').onSnapshot(doc => {
			            if (doc.exists) {
			                setMacroData(doc.data().events || []);
			                setLastUpdated(doc.data().last_updated);
			            }
			        });

			        // 实时监听新闻数据
			        const unsubNews = db.collection('market_data').doc('news').onSnapshot(doc => {
			            if (doc.exists) {
			                setNewsData(doc.data().articles || []);
			            }
			        });

			        return () => { unsubMacro(); unsubNews(); };
			    }, [isConfigured]);

			    if (!isConfigured) {
			        return (
			            <div className="flex flex-col items-center justify-center h-screen p-6 text-center">
			                <div className="w-16 h-16 bg-red-500/20 text-red-500 rounded-full flex items-center justify-center mb-4">
			                    <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
			                </div>
			                <h2 className="text-xl font-bold mb-2">连接失败</h2>
			                <p className="text-gray-400 text-sm">请在 index.html 代码中填入你的 firebaseConfig 密钥以连接数据库。</p>
			            </div>
			        );
			    }

			    return (
			        <div className="min-h-screen pb-20 font-sans">
			            {/* 顶部状态栏 */}
			            <div className="sticky top-0 bg-gray-900/90 backdrop-blur-lg border-b border-gray-800 px-5 py-4 z-40">
			                <div className="flex justify-between items-center">
			                    <h1 className="font-bold text-xl tracking-tight flex items-center gap-2">
			                        <span className="text-blue-500">
			                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
			                        </span>
			                        MarketMind
			                    </h1>
			                    <div className="text-xs text-gray-500 flex flex-col items-end">
			                        <span>云端同步正常</span>
			                        <span className="text-[10px]">{lastUpdated ? lastUpdated.split(' ')[1] : '--:--'}</span>
			                    </div>
			                </div>
			            </div>

			            <main className="p-5 space-y-6">
			                {/* 经济数据模块 */}
			                <section>
			                    <h2 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">今日经济数据前瞻</h2>
			                    {macroData.length === 0 ? (
			                        <div className="bg-gray-800/50 rounded-xl p-4 text-center text-gray-500 text-sm border border-gray-700/50">今日暂无高星级数据</div>
			                    ) : (
			                        <div className="space-y-3">
			                            {macroData.map((ev, idx) => (
			                                <div key={idx} className="bg-gradient-to-br from-gray-800 to-gray-850 rounded-xl p-4 border border-gray-700 shadow-lg">
			                                    <h3 className="text-white font-medium text-base mb-2">{ev.title}</h3>
			                                    <div className="bg-gray-900/50 rounded-lg p-3 text-sm text-gray-300 border border-gray-700/50">
			                                        <span className="text-blue-400 font-bold">AI剧本: </span>{ev.analysis}
			                                    </div>
			                                </div>
			                            ))}
			                        </div>
			                    )}
			                </section>

			                {/* 突发新闻模块 */}
			                <section>
			                    <h2 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-3">高价值市场情报</h2>
			                    {newsData.length === 0 ? (
			                        <div className="bg-gray-800/50 rounded-xl p-4 text-center text-gray-500 text-sm border border-gray-700/50">今日暂无评分 > 7 的突发情报</div>
			                    ) : (
			                        <div className="space-y-3">
			                            {newsData.map((news, idx) => {
			                                const isBullish = news.impact.includes("多");
			                                const isBearish = news.impact.includes("空");
			                                const color = isBullish ? "text-green-400 border-green-500/30 bg-green-500/10" :
			                                              isBearish ? "text-red-400 border-red-500/30 bg-red-500/10" :
			                                              "text-yellow-400 border-yellow-500/30 bg-yellow-500/10";

			                                return (
			                                    <div key={idx} className="bg-gray-800 rounded-xl p-4 border border-gray-700 relative overflow-hidden">
			                                        {/* 评分角标 */}
			                                        <div className={`absolute top-0 right-0 px-3 py-1 text-xs font-bold rounded-bl-lg ${news.score >= 9 ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-300'}`}>
			                                            {news.score} / 10
			                                        </div>

			                                        <h3 className="text-gray-100 font-medium text-sm pr-12 leading-snug mb-3">{news.title}</h3>

			                                        <div className={`text-xs p-2 rounded-lg border ${color} mb-2`}>
			                                            <span className="font-bold opacity-80">方向：</span>{news.impact}
			                                        </div>

			                                        <p className="text-gray-400 text-xs leading-relaxed">
			                                            <span className="text-gray-300 font-medium">AI 简评:</span> {news.reason}
			                                        </p>
			                                    </div>
			                                );
			                            })}
			                        </div>
			                    )}
			                </section>
			            </main>

			            {/* 底部模拟导航栏 (装饰性) */}
			            <div className="fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur-md border-t border-gray-800 px-6 py-3 flex justify-around items-center z-40 pb-safe">
			                <button className="flex flex-col items-center gap-1 text-blue-500">
			                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
			                    <span className="text-[10px] font-medium">情报</span>
			                </button>
			                <button className="flex flex-col items-center gap-1 text-gray-500">
			                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
			                    <span className="text-[10px] font-medium">日历</span>
			                </button>
			            </div>
			        </div>
			    );
			}

			const root = ReactDOM.createRoot(document.getElementById('root'));
			root.render(<App />);
		</script>
	</body>
</html>
